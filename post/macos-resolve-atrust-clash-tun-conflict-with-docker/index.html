<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>彻底解决 macOS 上 aTrust 与 Clash Tun 模式冲突：Docker 隔离与全能分流指南 | Choi's Notes</title><meta name=keywords content="macOS VPN conflict,aTrust Clash co-existence,OrbStack Docker EasyConnect,Google Antigravity,macOS 路由表冲突解决方案,深信服 VPN Docker 容器化"><meta name=description content="详解如何利用 OrbStack 和 Docker 隔离 aTrust VPN，配合 Clash Tun 模式彻底解决 macOS 下的路由冲突。实现同时流畅访问公司内网和 Google Antigravity 服务的终极网络方案。"><meta name=author content="Eric"><link rel=canonical href=https://smc.im/post/macos-resolve-atrust-clash-tun-conflict-with-docker/><link crossorigin=anonymous href=/assets/css/stylesheet.60564872284715922cda9461fe54e69034cf9a85cc54966df0cfa545c79d10ea.css integrity rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://smc.im/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://smc.im/favicon.ico><link rel=icon type=image/png sizes=32x32 href=https://smc.im/favicon.ico><link rel=apple-touch-icon href=https://smc.im/favicon.ico><link rel=mask-icon href=https://smc.im/favicon.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="彻底解决 macOS 上 aTrust 与 Clash Tun 模式冲突：Docker 隔离与全能分流指南"><meta property="og:description" content="详解如何利用 OrbStack 和 Docker 隔离 aTrust VPN，配合 Clash Tun 模式彻底解决 macOS 下的路由冲突。实现同时流畅访问公司内网和 Google Antigravity 服务的终极网络方案。"><meta property="og:type" content="article"><meta property="og:url" content="https://smc.im/post/macos-resolve-atrust-clash-tun-conflict-with-docker/"><meta property="article:section" content="post"><meta property="article:published_time" content="2025-11-26T11:01:32+08:00"><meta property="article:modified_time" content="2025-11-26T11:01:32+08:00"><meta property="og:site_name" content="Choi's Notes"><meta name=twitter:card content="summary"><meta name=twitter:title content="彻底解决 macOS 上 aTrust 与 Clash Tun 模式冲突：Docker 隔离与全能分流指南"><meta name=twitter:description content="详解如何利用 OrbStack 和 Docker 隔离 aTrust VPN，配合 Clash Tun 模式彻底解决 macOS 下的路由冲突。实现同时流畅访问公司内网和 Google Antigravity 服务的终极网络方案。"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://smc.im/post/"},{"@type":"ListItem","position":2,"name":"彻底解决 macOS 上 aTrust 与 Clash Tun 模式冲突：Docker 隔离与全能分流指南","item":"https://smc.im/post/macos-resolve-atrust-clash-tun-conflict-with-docker/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"彻底解决 macOS 上 aTrust 与 Clash Tun 模式冲突：Docker 隔离与全能分流指南","name":"彻底解决 macOS 上 aTrust 与 Clash Tun 模式冲突：Docker 隔离与全能分流指南","description":"详解如何利用 OrbStack 和 Docker 隔离 aTrust VPN，配合 Clash Tun 模式彻底解决 macOS 下的路由冲突。实现同时流畅访问公司内网和 Google Antigravity 服务的终极网络方案。","keywords":["macOS VPN conflict","aTrust Clash co-existence","OrbStack Docker EasyConnect","Google Antigravity","macOS 路由表冲突解决方案","深信服 VPN Docker 容器化"],"articleBody":"最近为了解决 Google Antigravity 网络问题，捣鼓了一下电脑的网络配置。\n背景与起因 最近在 macOS 上开发时遇到一个很烦人的网络冲突问题。\n我是使用自己的 mac mini 办公，公司的网络对外部网站的访问，限制得很严格，另外听说对访问流量也有监控，所以也是使用的自己的移动 WiFi（中兴的 F50）。\n这就造成了一个麻烦点，访问公司内部资源时必须使用 aTrust 开启 VPN（aTrust 是臭名昭著的深信服开发的一个 VPN 工具，EasyConnect 也是他们公司的），而日常查资料和开发又离不开 Clash 来访问国际站点。\n本来这两者共存也没什么大问题（我本来以为的，具体的下文再聊），但最近 Google 新推出的 AI 编辑器 Antigravity，必须在使用 Tun 模式下才能正常加载模型列表和问问题。\n这就导致了一个死循环：\n打开 Clash 的 Tun 模式：接管系统网卡后，aTrust 的虚拟网卡被覆盖或路由失效，内网断连。 关闭 Tun 模式：aTrust 正常了，但 Google Antigravity 无法正常使用。 后来在 LinuxDo 论坛 以及 V2EX 论坛 看到有人说可以使用 Proxifier 来管理 Antigravity 的网络，所以打算尝试 关闭 Clash Tun 模式 + 开启 aTrust + 开启 Proxifier 的模式，来解决上面的问题。\n不过现实是，同时开启 Proxifier 和 aTrust 也是冲突的：Proxifier 总是检测到 aTrust Agent 发生循环链路（就算在 rules 中排除也会一直弹），且此时也无法访问公司内网。\n归根结底，是两个软件都在抢夺宿主机的路由表和网络扩展控制权。\n反正就是 aTrust 太恶心！\n到这里，我其实有点绝望，不打算折腾了。直到我又搜索到一个好玩的项目：docker-easyconnect。\n解决思路 既然宿主机的路由表太拥挤，解决办法就是把“脏活”隔离开。\n我采用的方案是将 aTrust 扔进 Docker 容器里运行。容器内部通过 Tun 连接公司内网，然后暴露一个 SOCKS5 端口给宿主机。这样在 macOS 看来，aTrust 不再是一个修改系统网络配置的 VPN 软件，而只是一个普通的本地代理服务（Proxy）。接下来，在宿主机的 Clash 中添加这个 SOCKS5 代理，再把公司内网访问的 IP 分流到这个代理上就行了。\n最后，由宿主机的 Clash 统一接管流量：\n访问 公司内网 IP -\u003e 转发给 Docker 容器的 SOCKS5 端口。 访问 google.com 或其他外网 -\u003e 转发给机场节点。 Clash 开启 Tun 模式 -\u003e 解决 Antigravity 的流量劫持问题。 拓扑结构 在这个方案中，OrbStack 是个关键。相比 Docker Desktop，它的网络桥接更直观，容器可以直接通过 IP 或 mDNS 访问，省去了很多端口映射的麻烦。\n整体流量走向如下：\ngraph TD subgraph macOS [macOS 宿主机] App[Android Studio / 浏览器 / 终端] --\u003e|Tun 流量劫持| Clash Clash --\u003e|Rule: 公司内网 IP| Proxy_Local[Proxy: Docker aTrust] Clash --\u003e|Rule: Google/外网| Proxy_Remote[Proxy: 机场节点] end subgraph OrbStack [OrbStack 容器环境] Proxy_Local -.-\u003e|Socks5| Container[docker-easyconnect] subgraph Container_Internal [容器内部] Container --\u003e|Tun 拨号| VPN_Interface end end VPN_Interface --\u003e|内网流量| Company_Gateway[公司网关] Proxy_Remote --\u003e|外网流量| Internet[互联网] 架构理清了，下面记录一下具体的配置过程。\n实战步骤 准备工作 OrbStack: macOS 上 Docker Desktop 的最佳替代品，轻量且网络互通性极好。 VNC Viewer: 用于访问容器内的图形界面（aTrust 登录框）。 Clash: 我使用的是 FlClash，支持 Tun 模式即可。 部署 aTrust 容器 这里使用 docker-easyconnect 这个项目。相比于直接 docker run，我更习惯用 docker-compose 管理，方便后续调整参数。\n在任意目录下创建 docker-compose.yml：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 services: atrust: image: hagb/docker-atrust:latest container_name: atrust # [新增] 特权模式：解决路由表报错和网络不稳定的关键 privileged: true restart: unless-stopped devices: - /dev/net/tun # 虽然有了 privileged，保留 cap_add 也没坏处 cap_add: - NET_ADMIN ports: # SOCKS5 端口：Clash 将通过这个端口连接内网 - \"1080:1080\" # VNC 端口 - \"5901:5901\" # HTTP 端口备用，这里可以注释掉或留着 - \"8888:8888\" environment: - PASSWORD=123456 - URLWIN=1 volumes: - ./data:/root sysctls: - net.ipv4.conf.default.route_localnet=1 启动容器：\n1 docker-compose up -d 登录 VPN 容器启动后，aTrust 已经在后台运行，但还没登录。\n下载 VNC Viewer，然后打开。 地址栏输入：127.0.0.1:5901。 输入密码（对应上面 yaml 里的 PASSWORD）。 此时你应该能看到熟悉的 aTrust 登录界面。输入服务器地址、用户名、密码。 登录成功后，不要关闭容器，直接关掉 VNC 窗口即可。 验证连接： 在终端里测试一下容器内部是否通了：\n1 docker exec -it atrust ping \u003c你公司内网的某个IP\u003e 如果能 ping 通，说明容器内的 VPN 隧道已经建立。\n配置 Clash 分流 这是最关键的一步。我们需要告诉宿主机的 Clash：“凡是公司 IP 的请求，都转发给本地 1080 端口”。\n我使用 FlClash 这款软件，可以直接在 配置 页面添加脚本：\n新增脚本，然后直接填写如下代码：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 function main(config) { // ================= 配置区域 (请修改这里) ================= // 1. 你的主力代理组名称 // 打开 FlClash 看一眼，通常叫 \"Proxy\"、\"节点选择\"、\"🚀 节点选择\" 或 \"Select\" // 如果填错，那个境外 App 就没法联网。 const MAIN_GROUP_NAME = \"Proxies\"; // 2. 你的公司内网配置 const COMPANY_PROXY_NAME = \"🏢 公司内网\"; // ======================================================= // === A. 定义公司内网信息 (请在此处修改) === const COMPANY_PROXY = { name: \"🏢 公司内网\", type: \"socks5\", server: \"127.0.0.1\", port: 1080, password: \"123456\" // 如果有 username/password 也可以加在这里 }; // 必须走内网的规则 (优先级最高) // 优先处理：公司内网 IP const COMPANY_RULES = [ // --- 排除所有内网流量 --- // 10.x.x.x 网段 \"IP-CIDR,10.10.100.10/32,🏢 公司内网\", \"IP-CIDR,10.10.103.0/24,🏢 公司内网\", // ... 其他 IP // 172.x.x.x 网段 \"IP-CIDR,172.30.0.0/23,🏢 公司内网\", \"IP-CIDR,172.30.12.0/24,🏢 公司内网\", // ... 其他 IP // 192.168.x.x 网段 \"IP-CIDR,192.168.1.0/25,🏢 公司内网\", \"IP-CIDR,192.168.1.128/26,🏢 公司内网\", // ... 其他 IP ]; if (!config.proxies) config.proxies = []; // === 2. 将公司节点加入节点列表 === config.proxies.unshift(COMPANY_PROXY); // 插到第一个，方便找 // D. 把自定义规则合并到原有规则的最前面 // 这样既保留了机场规则，又保证了你的规则优先级最高 if (!config.rules) config.rules = []; config.rules = [...COMPANY_RULES, ...config.rules]; return config; } 此时，你不需要开启 Tun 模式，浏览器应该已经可以同时访问 google.com 和公司内网 IP 了。\n解决 Antigravity 问题 回到最初的痛点：Antigravity 如果不走 Tun，根本拉不到模型列表，且无法正常对话。\n现在宿主机的环境非常干净：\n没有 aTrust 抢占网卡。 路由表未被污染。 方案 A：开启 Clash Tun 模式（推荐）\n直接在 Clash 客户端打开 Tun 模式。\nClash 创建虚拟网卡接管系统所有流量。 Antigravity 发起的连接被 Clash 捕获。 Clash 发现是 google.com 或相关 AI 域名 -\u003e 走代理（成功）。 Clash 发现是内网域名 -\u003e 转发给 Docker-aTrust -\u003e 容器内 Tun -\u003e 公司内网（成功）。 至此，冲突完美解决。\n方案 B：Proxifier 强制接管（备选）\n如果你因为某些原因不想开 Tun 模式（比如想要更精细的进程级控制），可以使用 Proxifier。\nProxies 设置：添加 127.0.0.1:7890 (Clash HTTP 端口) 为主代理。 Rules 设置： Application: com.google.antigravity.helper;com.google.antigravity;Antigravity;language_server_macos_arm; (根据实际进程名添加，如果是 Intel 芯片的 Mac，则需要将最后一项改为 language_server_macos_x64) Action: Proxy HTTP 127.0.0.1:7890 这样能在不开启 Tun 的情况下，强行让 Antigravity 走代理。但这种方式需要多开一个 Proxifier App，所以个人更推荐方案 A。\n总结 这套方案把“脏乱差”的 VPN 客户端关进了 Docker，还给了 macOS 一个清爽的网络环境。 虽然前期配置稍微麻烦点（写 Compose、配 Clash），但一旦跑通，后续的使用体验就是无感的。不再需要手动开关软件，也不用担心路由表爆炸，这才是开发环境该有的样子。\n注意：我在本文前面提到，我本来以为 aTrust 和 Clash Tun 这两者共存也没什么大问题，但是后来别人提醒，aTrust 只要启动了，无论是否退出，都会有进程在后台监控流量。虽然“在后台监控流量”这件事，我没有去验证，但是我确实发现，当完全退出 aTrust 后，在 macOS 自带的活动监视器中，发现仍然有名为 aTrust Agent 的进程在后台活跃，这就让我产生了疑心。\n所以，我最终决定，无论是否使用 Clash Tun 模式，aTrust 这个垃圾软件，注定必须要使用 Docker 容器隔离了。\n致谢 https://github.com/docker-easyconnect/docker-easyconnect https://linux.do/t/topic/1192827 https://www.v2ex.com/t/1174715 https://gemini.google.com ","wordCount":"3079","inLanguage":"en","datePublished":"2025-11-26T11:01:32+08:00","dateModified":"2025-11-26T11:01:32+08:00","author":{"@type":"Person","name":"Eric"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://smc.im/post/macos-resolve-atrust-clash-tun-conflict-with-docker/"},"publisher":{"@type":"Organization","name":"Choi's Notes","logo":{"@type":"ImageObject","url":"https://smc.im/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://smc.im/ accesskey=h title="Choi's Notes (Alt + H)"><img src=https://smc.im/favicon.ico alt aria-label=logo height=35>Choi's Notes</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://smc.im/categories/ title=📖分类><span>📖分类</span></a></li><li><a href=https://smc.im/tags/ title=🏷️标签><span>🏷️标签</span></a></li><li><a href=https://smc.im/about/ title=🐼关于我><span>🐼关于我</span></a></li><li><a href=https://smc.im/friend/ title=👫友链><span>👫友链</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://smc.im/>Home</a>&nbsp;»&nbsp;<a href=https://smc.im/post/>Posts</a></div><h1 class=post-title>彻底解决 macOS 上 aTrust 与 Clash Tun 模式冲突：Docker 隔离与全能分流指南</h1><div class=post-description>详解如何利用 OrbStack 和 Docker 隔离 aTrust VPN，配合 Clash Tun 模式彻底解决 macOS 下的路由冲突。实现同时流畅访问公司内网和 Google Antigravity 服务的终极网络方案。</div><div class=post-meta><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css><style>i[id*=post_meta_style]{display:flex;align-items:center;margin:0 0 10px}.parent-post-meta{display:flex;flex-wrap:wrap;opacity:.8}</style><span class=parent-post-meta><span id=post_meta_style_1><span class="fa fa-calendar-check-o"></span>
<span>2025-11-26
&nbsp;&nbsp;</span></span>
<span id=post_meta_style_3><span class="fa fa-file-word-o"></span>
<span>3079字
&nbsp;&nbsp;</span></span>
<span id=post_meta_style_4><span class="fa fa-clock-o"></span>
<span>7分钟
&nbsp;&nbsp;</span></span>
<span id=post_meta_style_5><span class="fa fa-user-o"></span>
<span>Eric
&nbsp;&nbsp;</span></span>
<span id=post_meta_style_6><span class="fa fa-tags" style=opacity:.8></span>
<span><span class=post-tags-meta><a href=https://smc.im/tags/mac/ style=color:var(--secondary)!important>Mac</a>
&nbsp;<a href=https://smc.im/tags/macos/ style=color:var(--secondary)!important>macOS</a>
&nbsp;<a href=https://smc.im/tags/clash/ style=color:var(--secondary)!important>Clash</a>
&nbsp;<a href=https://smc.im/tags/tun/ style=color:var(--secondary)!important>tun</a>
&nbsp;<a href=https://smc.im/tags/atrust/ style=color:var(--secondary)!important>aTrust</a>
&nbsp;<a href=https://smc.im/tags/easyconnect/ style=color:var(--secondary)!important>EasyConnect</a>
&nbsp;<a href=https://smc.im/tags/antigravity/ style=color:var(--secondary)!important>Antigravity</a>
&nbsp;<a href=https://smc.im/tags/docker/ style=color:var(--secondary)!important>Docker</a>
&nbsp;<a href=https://smc.im/tags/orbstack/ style=color:var(--secondary)!important>OrbStack</a>
&nbsp;<a href=https://smc.im/tags/network/ style=color:var(--secondary)!important>Network</a></span></span></span></span></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%e8%83%8c%e6%99%af%e4%b8%8e%e8%b5%b7%e5%9b%a0 aria-label=背景与起因>背景与起因</a></li><li><a href=#%e8%a7%a3%e5%86%b3%e6%80%9d%e8%b7%af aria-label=解决思路>解决思路</a></li><li><a href=#%e6%8b%93%e6%89%91%e7%bb%93%e6%9e%84 aria-label=拓扑结构>拓扑结构</a></li><li><a href=#%e5%ae%9e%e6%88%98%e6%ad%a5%e9%aa%a4 aria-label=实战步骤>实战步骤</a></li><li><a href=#%e8%a7%a3%e5%86%b3-antigravity-%e9%97%ae%e9%a2%98 aria-label="解决 Antigravity 问题">解决 Antigravity 问题</a></li><li><a href=#%e6%80%bb%e7%bb%93 aria-label=总结>总结</a></li><li><a href=#%e8%87%b4%e8%b0%a2 aria-label=致谢>致谢</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><p>最近为了解决 Google Antigravity 网络问题，捣鼓了一下电脑的网络配置。</p><h2 id=背景与起因>背景与起因<a hidden class=anchor aria-hidden=true href=#背景与起因>#</a></h2><p>最近在 macOS 上开发时遇到一个很烦人的网络冲突问题。</p><p>我是使用自己的 mac mini 办公，公司的网络对外部网站的访问，限制得很严格，另外听说对访问流量也有监控，所以也是使用的自己的移动 WiFi（中兴的 F50）。</p><p>这就造成了一个麻烦点，访问公司内部资源时必须使用 aTrust 开启 VPN（aTrust 是臭名昭著的深信服开发的一个 VPN 工具，EasyConnect 也是他们公司的），而日常查资料和开发又离不开 Clash 来访问国际站点。</p><p>本来这两者共存也没什么大问题（我本来以为的，具体的下文再聊），但最近 Google 新推出的 AI 编辑器 Antigravity，必须在使用 Tun 模式下才能正常加载模型列表和问问题。</p><p>这就导致了一个死循环：</p><ol><li><strong>打开 Clash 的 Tun 模式</strong>：接管系统网卡后，aTrust 的虚拟网卡被覆盖或路由失效，内网断连。</li><li><strong>关闭 Tun 模式</strong>：aTrust 正常了，但 Google Antigravity 无法正常使用。</li></ol><p>后来在 <a href=https://linux.do/t/topic/1192827>LinuxDo 论坛</a> 以及 <a href=https://www.v2ex.com/t/1174715>V2EX 论坛</a> 看到有人说可以使用 Proxifier 来管理 Antigravity 的网络，所以打算尝试 <code>关闭 Clash Tun 模式 + 开启 aTrust + 开启 Proxifier</code> 的模式，来解决上面的问题。</p><p>不过现实是，同时开启 Proxifier 和 aTrust 也是冲突的：Proxifier 总是检测到 aTrust Agent 发生循环链路（就算在 rules 中排除也会一直弹），且此时也无法访问公司内网。</p><p>归根结底，是两个软件都在抢夺宿主机的路由表和网络扩展控制权。</p><p>反正就是 aTrust 太恶心！</p><p>到这里，我其实有点绝望，不打算折腾了。直到我又搜索到一个好玩的项目：<a href=https://github.com/docker-easyconnect/docker-easyconnect>docker-easyconnect</a>。</p><h2 id=解决思路>解决思路<a hidden class=anchor aria-hidden=true href=#解决思路>#</a></h2><p>既然宿主机的路由表太拥挤，解决办法就是把“脏活”隔离开。</p><p>我采用的方案是将 aTrust 扔进 Docker 容器里运行。容器内部通过 Tun 连接公司内网，然后暴露一个 SOCKS5 端口给宿主机。这样在 macOS 看来，aTrust 不再是一个修改系统网络配置的 VPN 软件，而只是一个普通的本地代理服务（Proxy）。接下来，在宿主机的 Clash 中添加这个 SOCKS5 代理，再把公司内网访问的 IP 分流到这个代理上就行了。</p><p>最后，由宿主机的 Clash 统一接管流量：</p><ul><li>访问 <code>公司内网 IP</code> -> 转发给 Docker 容器的 SOCKS5 端口。</li><li>访问 <code>google.com</code> 或其他外网 -> 转发给机场节点。</li><li>Clash 开启 Tun 模式 -> 解决 Antigravity 的流量劫持问题。</li></ul><h2 id=拓扑结构>拓扑结构<a hidden class=anchor aria-hidden=true href=#拓扑结构>#</a></h2><p>在这个方案中，<strong>OrbStack</strong> 是个关键。相比 Docker Desktop，它的网络桥接更直观，容器可以直接通过 IP 或 mDNS 访问，省去了很多端口映射的麻烦。</p><p>整体流量走向如下：</p><pre tabindex=0><code>graph TD
    subgraph macOS [macOS 宿主机]
        App[Android Studio / 浏览器 / 终端] --&gt;|Tun 流量劫持| Clash
        
        Clash --&gt;|Rule: 公司内网 IP| Proxy_Local[Proxy: Docker aTrust]
        Clash --&gt;|Rule: Google/外网| Proxy_Remote[Proxy: 机场节点]
    end

    subgraph OrbStack [OrbStack 容器环境]
        Proxy_Local -.-&gt;|Socks5| Container[docker-easyconnect]
        
        subgraph Container_Internal [容器内部]
            Container --&gt;|Tun 拨号| VPN_Interface
        end
    end

    VPN_Interface --&gt;|内网流量| Company_Gateway[公司网关]
    Proxy_Remote --&gt;|外网流量| Internet[互联网]
</code></pre><p>架构理清了，下面记录一下具体的配置过程。</p><h2 id=实战步骤>实战步骤<a hidden class=anchor aria-hidden=true href=#实战步骤>#</a></h2><ol><li>准备工作</li></ol><ul><li><strong>OrbStack</strong>: macOS 上 Docker Desktop 的最佳替代品，轻量且网络互通性极好。</li><li><strong>VNC Viewer</strong>: 用于访问容器内的图形界面（aTrust 登录框）。</li><li><strong>Clash</strong>: 我使用的是 FlClash，支持 Tun 模式即可。</li></ul><ol start=2><li>部署 aTrust 容器</li></ol><p>这里使用 <a href=https://github.com/docker-easyconnect/docker-easyconnect>docker-easyconnect</a> 这个项目。相比于直接 docker run，我更习惯用 docker-compose 管理，方便后续调整参数。</p><p>在任意目录下创建 <code>docker-compose.yml</code>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>atrust</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>hagb/docker-atrust:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>atrust</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># [新增] 特权模式：解决路由表报错和网络不稳定的关键</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>privileged</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class=l>unless-stopped</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>devices</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>/dev/net/tun</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># 虽然有了 privileged，保留 cap_add 也没坏处</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>cap_add</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>NET_ADMIN</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># SOCKS5 端口：Clash 将通过这个端口连接内网</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;1080:1080&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># VNC 端口</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;5901:5901&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># HTTP 端口备用，这里可以注释掉或留着</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;8888:8888&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>PASSWORD=123456</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>URLWIN=1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./data:/root</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>sysctls</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>net.ipv4.conf.default.route_localnet=1</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>启动容器：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker-compose up -d
</span></span></code></pre></td></tr></table></div></div><ol start=3><li>登录 VPN</li></ol><p>容器启动后，aTrust 已经在后台运行，但还没登录。</p><ul><li>下载 <a href=https://www.realvnc.com/en/connect/download/viewer/macos/><strong>VNC Viewer</strong></a>，然后打开。</li><li>地址栏输入：<code>127.0.0.1:5901</code>。</li><li>输入密码（对应上面 yaml 里的 <code>PASSWORD</code>）。</li><li>此时你应该能看到熟悉的 aTrust 登录界面。输入服务器地址、用户名、密码。</li><li>登录成功后，不要关闭容器，直接关掉 VNC 窗口即可。</li></ul><p><strong>验证连接：</strong> 在终端里测试一下容器内部是否通了：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker <span class=nb>exec</span> -it atrust ping &lt;你公司内网的某个IP&gt;
</span></span></code></pre></td></tr></table></div></div><p>如果能 ping 通，说明容器内的 VPN 隧道已经建立。</p><ol start=4><li>配置 Clash 分流</li></ol><p>这是最关键的一步。我们需要告诉宿主机的 Clash：<strong>“凡是公司 IP 的请求，都转发给本地 1080 端口”</strong>。</p><p>我使用 FlClash 这款软件，可以直接在 <strong>配置</strong> 页面添加脚本：</p><p><img loading=lazy src=https://s3.bmp.ovh/imgs/2025/11/26/a7ce49b9efa095b5.png alt></p><p>新增脚本，然后直接填写如下代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>main</span><span class=p>(</span><span class=nx>config</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// ================= 配置区域 (请修改这里) =================
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=c1>// 1. 你的主力代理组名称
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// 打开 FlClash 看一眼，通常叫 &#34;Proxy&#34;、&#34;节点选择&#34;、&#34;🚀 节点选择&#34; 或 &#34;Select&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// 如果填错，那个境外 App 就没法联网。
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=nx>MAIN_GROUP_NAME</span> <span class=o>=</span> <span class=s2>&#34;Proxies&#34;</span><span class=p>;</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// 2. 你的公司内网配置
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=nx>COMPANY_PROXY_NAME</span> <span class=o>=</span> <span class=s2>&#34;🏢 公司内网&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// =======================================================
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=c1>// === A. 定义公司内网信息 (请在此处修改) ===
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=nx>COMPANY_PROXY</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>name</span><span class=o>:</span> <span class=s2>&#34;🏢 公司内网&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>type</span><span class=o>:</span> <span class=s2>&#34;socks5&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>server</span><span class=o>:</span> <span class=s2>&#34;127.0.0.1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>port</span><span class=o>:</span> <span class=mi>1080</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>password</span><span class=o>:</span> <span class=s2>&#34;123456&#34;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 如果有 username/password 也可以加在这里
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>};</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 必须走内网的规则 (优先级最高)
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// 优先处理：公司内网 IP
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=nx>COMPANY_RULES</span> <span class=o>=</span> <span class=p>[</span>    
</span></span><span class=line><span class=cl>    <span class=c1>// --- 排除所有内网流量 ---
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// 10.x.x.x 网段
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=s2>&#34;IP-CIDR,10.10.100.10/32,🏢 公司内网&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;IP-CIDR,10.10.103.0/24,🏢 公司内网&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ... 其他 IP
</span></span></span><span class=line><span class=cl><span class=c1></span>    
</span></span><span class=line><span class=cl>    <span class=c1>// 172.x.x.x 网段
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=s2>&#34;IP-CIDR,172.30.0.0/23,🏢 公司内网&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;IP-CIDR,172.30.12.0/24,🏢 公司内网&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ... 其他 IP
</span></span></span><span class=line><span class=cl><span class=c1></span>    
</span></span><span class=line><span class=cl>    <span class=c1>// 192.168.x.x 网段
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=s2>&#34;IP-CIDR,192.168.1.0/25,🏢 公司内网&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;IP-CIDR,192.168.1.128/26,🏢 公司内网&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ... 其他 IP
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>];</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>config</span><span class=p>.</span><span class=nx>proxies</span><span class=p>)</span> <span class=nx>config</span><span class=p>.</span><span class=nx>proxies</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// === 2. 将公司节点加入节点列表 ===
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>config</span><span class=p>.</span><span class=nx>proxies</span><span class=p>.</span><span class=nx>unshift</span><span class=p>(</span><span class=nx>COMPANY_PROXY</span><span class=p>);</span> <span class=c1>// 插到第一个，方便找
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=c1>// D. 把自定义规则合并到原有规则的最前面
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// 这样既保留了机场规则，又保证了你的规则优先级最高
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>config</span><span class=p>.</span><span class=nx>rules</span><span class=p>)</span> <span class=nx>config</span><span class=p>.</span><span class=nx>rules</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>  <span class=nx>config</span><span class=p>.</span><span class=nx>rules</span> <span class=o>=</span> <span class=p>[...</span><span class=nx>COMPANY_RULES</span><span class=p>,</span> <span class=p>...</span><span class=nx>config</span><span class=p>.</span><span class=nx>rules</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>config</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>此时，你不需要开启 Tun 模式，浏览器应该已经可以同时访问 <code>google.com</code> 和公司内网 IP 了。</p><h2 id=解决-antigravity-问题>解决 Antigravity 问题<a hidden class=anchor aria-hidden=true href=#解决-antigravity-问题>#</a></h2><p>回到最初的痛点：Antigravity 如果不走 Tun，根本拉不到模型列表，且无法正常对话。</p><p>现在宿主机的环境非常干净：</p><ol><li>没有 aTrust 抢占网卡。</li><li>路由表未被污染。</li></ol><p><strong>方案 A：开启 Clash Tun 模式（推荐）</strong></p><p>直接在 Clash 客户端打开 <strong>Tun 模式</strong>。</p><ul><li>Clash 创建虚拟网卡接管系统所有流量。</li><li>Antigravity 发起的连接被 Clash 捕获。</li><li>Clash 发现是 <code>google.com</code> 或相关 AI 域名 -> 走代理（成功）。</li><li>Clash 发现是内网域名 -> 转发给 <code>Docker-aTrust</code> -> 容器内 Tun -> 公司内网（成功）。</li></ul><p>至此，冲突完美解决。</p><p><strong>方案 B：Proxifier 强制接管（备选）</strong></p><p>如果你因为某些原因不想开 Tun 模式（比如想要更精细的进程级控制），可以使用 Proxifier。</p><ol><li><strong>Proxies 设置</strong>：添加 <code>127.0.0.1:7890</code> (Clash HTTP 端口) 为主代理。</li></ol><p><img loading=lazy src=https://s3.bmp.ovh/imgs/2025/11/26/880ea1d50f9a84ee.png alt></p><ol start=2><li><strong>Rules 设置</strong>：</li></ol><ul><li>Application: <code>com.google.antigravity.helper;com.google.antigravity;Antigravity;language_server_macos_arm;</code> (根据实际进程名添加，如果是 Intel 芯片的 Mac，则需要将最后一项改为 <code>language_server_macos_x64</code>)</li><li>Action: <code>Proxy HTTP 127.0.0.1:7890</code></li></ul><p><img loading=lazy src=https://s3.bmp.ovh/imgs/2025/11/26/2722706a093b118a.png alt></p><p>这样能在不开启 Tun 的情况下，强行让 Antigravity 走代理。但这种方式需要多开一个 Proxifier App，所以个人更推荐方案 A。</p><h2 id=总结>总结<a hidden class=anchor aria-hidden=true href=#总结>#</a></h2><p>这套方案把“脏乱差”的 VPN 客户端关进了 Docker，还给了 macOS 一个清爽的网络环境。 虽然前期配置稍微麻烦点（写 Compose、配 Clash），但一旦跑通，后续的使用体验就是无感的。不再需要手动开关软件，也不用担心路由表爆炸，这才是开发环境该有的样子。</p><p><strong>注意</strong>：我在本文前面提到，我本来以为 aTrust 和 Clash Tun 这两者共存也没什么大问题，但是后来别人提醒，<strong>aTrust 只要启动了，无论是否退出，都会有进程在后台监控流量</strong>。虽然“在后台监控流量”这件事，我没有去验证，但是我确实发现，当完全退出 aTrust 后，在 macOS 自带的活动监视器中，发现仍然有名为 <code>aTrust Agent</code> 的进程在后台活跃，这就让我产生了疑心。</p><p>所以，我最终决定，无论是否使用 Clash Tun 模式，aTrust 这个垃圾软件，注定必须要使用 Docker 容器隔离了。</p><h2 id=致谢>致谢<a hidden class=anchor aria-hidden=true href=#致谢>#</a></h2><ul><li><a href=https://github.com/docker-easyconnect/docker-easyconnect>https://github.com/docker-easyconnect/docker-easyconnect</a></li><li><a href=https://linux.do/t/topic/1192827>https://linux.do/t/topic/1192827</a></li><li><a href=https://www.v2ex.com/t/1174715>https://www.v2ex.com/t/1174715</a></li><li><a href=https://gemini.google.com>https://gemini.google.com</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://smc.im/tags/mac/>Mac</a></li><li><a href=https://smc.im/tags/macos/>macOS</a></li><li><a href=https://smc.im/tags/clash/>Clash</a></li><li><a href=https://smc.im/tags/tun/>tun</a></li><li><a href=https://smc.im/tags/atrust/>aTrust</a></li><li><a href=https://smc.im/tags/easyconnect/>EasyConnect</a></li><li><a href=https://smc.im/tags/antigravity/>Antigravity</a></li><li><a href=https://smc.im/tags/docker/>Docker</a></li><li><a href=https://smc.im/tags/orbstack/>OrbStack</a></li><li><a href=https://smc.im/tags/network/>Network</a></li></ul><nav class=paginav><a class=next href=https://smc.im/post/issues-when-installing-macos-on-an-external-ssd/><span class=title>Next »</span><br><span>在外接 SSD 中安装 macOS 遇到的一些问题</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share 彻底解决 macOS 上 aTrust 与 Clash Tun 模式冲突：Docker 隔离与全能分流指南 on twitter" href="https://twitter.com/intent/tweet/?text=%e5%bd%bb%e5%ba%95%e8%a7%a3%e5%86%b3%20macOS%20%e4%b8%8a%20aTrust%20%e4%b8%8e%20Clash%20Tun%20%e6%a8%a1%e5%bc%8f%e5%86%b2%e7%aa%81%ef%bc%9aDocker%20%e9%9a%94%e7%a6%bb%e4%b8%8e%e5%85%a8%e8%83%bd%e5%88%86%e6%b5%81%e6%8c%87%e5%8d%97&amp;url=https%3a%2f%2fsmc.im%2fpost%2fmacos-resolve-atrust-clash-tun-conflict-with-docker%2f&amp;hashtags=Mac%2cmacOS%2cClash%2ctun%2caTrust%2cEasyConnect%2cAntigravity%2cDocker%2cOrbStack%2cNetwork"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 彻底解决 macOS 上 aTrust 与 Clash Tun 模式冲突：Docker 隔离与全能分流指南 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fsmc.im%2fpost%2fmacos-resolve-atrust-clash-tun-conflict-with-docker%2f&amp;title=%e5%bd%bb%e5%ba%95%e8%a7%a3%e5%86%b3%20macOS%20%e4%b8%8a%20aTrust%20%e4%b8%8e%20Clash%20Tun%20%e6%a8%a1%e5%bc%8f%e5%86%b2%e7%aa%81%ef%bc%9aDocker%20%e9%9a%94%e7%a6%bb%e4%b8%8e%e5%85%a8%e8%83%bd%e5%88%86%e6%b5%81%e6%8c%87%e5%8d%97&amp;summary=%e5%bd%bb%e5%ba%95%e8%a7%a3%e5%86%b3%20macOS%20%e4%b8%8a%20aTrust%20%e4%b8%8e%20Clash%20Tun%20%e6%a8%a1%e5%bc%8f%e5%86%b2%e7%aa%81%ef%bc%9aDocker%20%e9%9a%94%e7%a6%bb%e4%b8%8e%e5%85%a8%e8%83%bd%e5%88%86%e6%b5%81%e6%8c%87%e5%8d%97&amp;source=https%3a%2f%2fsmc.im%2fpost%2fmacos-resolve-atrust-clash-tun-conflict-with-docker%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 彻底解决 macOS 上 aTrust 与 Clash Tun 模式冲突：Docker 隔离与全能分流指南 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fsmc.im%2fpost%2fmacos-resolve-atrust-clash-tun-conflict-with-docker%2f&title=%e5%bd%bb%e5%ba%95%e8%a7%a3%e5%86%b3%20macOS%20%e4%b8%8a%20aTrust%20%e4%b8%8e%20Clash%20Tun%20%e6%a8%a1%e5%bc%8f%e5%86%b2%e7%aa%81%ef%bc%9aDocker%20%e9%9a%94%e7%a6%bb%e4%b8%8e%e5%85%a8%e8%83%bd%e5%88%86%e6%b5%81%e6%8c%87%e5%8d%97"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 彻底解决 macOS 上 aTrust 与 Clash Tun 模式冲突：Docker 隔离与全能分流指南 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fsmc.im%2fpost%2fmacos-resolve-atrust-clash-tun-conflict-with-docker%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 彻底解决 macOS 上 aTrust 与 Clash Tun 模式冲突：Docker 隔离与全能分流指南 on whatsapp" href="https://api.whatsapp.com/send?text=%e5%bd%bb%e5%ba%95%e8%a7%a3%e5%86%b3%20macOS%20%e4%b8%8a%20aTrust%20%e4%b8%8e%20Clash%20Tun%20%e6%a8%a1%e5%bc%8f%e5%86%b2%e7%aa%81%ef%bc%9aDocker%20%e9%9a%94%e7%a6%bb%e4%b8%8e%e5%85%a8%e8%83%bd%e5%88%86%e6%b5%81%e6%8c%87%e5%8d%97%20-%20https%3a%2f%2fsmc.im%2fpost%2fmacos-resolve-atrust-clash-tun-conflict-with-docker%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 彻底解决 macOS 上 aTrust 与 Clash Tun 模式冲突：Docker 隔离与全能分流指南 on telegram" href="https://telegram.me/share/url?text=%e5%bd%bb%e5%ba%95%e8%a7%a3%e5%86%b3%20macOS%20%e4%b8%8a%20aTrust%20%e4%b8%8e%20Clash%20Tun%20%e6%a8%a1%e5%bc%8f%e5%86%b2%e7%aa%81%ef%bc%9aDocker%20%e9%9a%94%e7%a6%bb%e4%b8%8e%e5%85%a8%e8%83%bd%e5%88%86%e6%b5%81%e6%8c%87%e5%8d%97&amp;url=https%3a%2f%2fsmc.im%2fpost%2fmacos-resolve-atrust-clash-tun-conflict-with-docker%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer><script src=https://utteranc.es/client.js repo=realchoi/hugo_comments issue-term=pathname label=Comment theme=github-light crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2025 <a href=https://smc.im/>Choi's Notes</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>